---
title: "hw10ver2"
author: "Ketong Zhang"
date: "2024-02-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load the libraries
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(naniar)
``` 

## Desert Ecology
For this assignment, we are going to use a modified data set on [desert ecology](http://esapubs.org/archive/ecol/E090/118/). The data are from: S. K. Morgan Ernest, Thomas J. Valone, and James H. Brown. 2009. Long-term monitoring and experimental manipulation of a Chihuahuan Desert ecosystem near Portal, Arizona, USA. Ecology 90:1708.
```{r}
deserts <- read_csv("data/surveys_complete.csv") %>% clean_names()
```

1. Use the function(s) of your choice to get an idea of its structure, including how NA's are treated. Are the data tidy?  
```{r}
glimpse(deserts)
```

```{r}
summary(deserts)
```


2. How many genera and species are represented in the data? What are the total number of observations? Which species is most/ least frequently sampled in the study?

Genera
```{r}
deserts %>% 
  count(genus)
```
Species
Merriami is the most observed species
Clariki, scutalatus, tereticaudus, tigris, uniparens, viridis are the least observed species.
```{r}
deserts %>% 
  count(species)
```
There are total of 40 species and 26 genus.  A total of 34786 observations.
```{r}
n_distinct(deserts$species)
```

```{r}
n_distinct(deserts$genus)
```

```{r}
str(deserts)
```

3. What is the proportion of taxa included in this study? Show a table and plot that reflects this count.
```{r}
tabyl(deserts$taxa)
```

```{r}
deserts %>% 
  ggplot(aes(x= taxa))+
  geom_bar()+
  coord_flip()+
  scale_y_log10()
```


4. For the taxa included in the study, use the fill option to show the proportion of individuals sampled by `plot_type.`
```{r}
deserts %>% 
  ggplot(aes(x= taxa, fill = plot_type))+
  geom_bar(position = "dodge")+
  coord_flip()+
  scale_y_log10()
```

5. What is the range of weight for each species included in the study? Remove any observations of weight that are NA so they do not show up in the plot.
```{r}
deserts %>% 
  filter(weight!="NA") %>% 
  group_by(species) %>% 
  ggplot(aes(x=species, y=weight, na.rm=TRUE))+
  geom_boxplot()+
  coord_flip()
```

```{r}

```

6. Add another layer to your answer from #5 using `geom_point` to get an idea of how many measurements were taken for each species.

```{r}
deserts %>% 
  filter(weight!="NA") %>% 
  group_by(species) %>% 
  ggplot(aes(x=species, y=weight, na.rm=TRUE))+
  geom_boxplot()+
  geom_point()+
  coord_flip()
```


7. [Dipodomys merriami](https://en.wikipedia.org/wiki/Merriam's_kangaroo_rat) is the most frequently sampled animal in the study. How have the number of observations of this species changed over the years included in the study?

The number of observations increase.
```{r}
deserts %>% 
  filter(species == "merriami") %>% 
  group_by(year) %>% 
  count(species) %>% 
  ggplot(aes(x = year, y = n))+
  geom_line()
```


8. What is the relationship between `weight` and `hindfoot` length? Consider whether or not over plotting is an issue.

There is a positive correlation between weight and hindfoot length 
```{r}
deserts %>% 
  group_by(weight, hindfoot_length) %>% 
  ggplot(aes(x=weight, y=hindfoot_length, na.rm=T))+
  geom_jitter(na.rm=T)+
  scale_y_log10()
```


9. Which two species have, on average, the highest weight? Once you have identified them, make a new column that is a ratio of `weight` to `hindfoot_length`. Make a plot that shows the range of this new ratio and fill by sex.

Albigula and spectabilis are the 2 species that have the highest average weight.
```{r}
deserts %>% 
  filter(weight != "NA") %>% 
  select(species, weight, hindfoot_length) %>% 
  group_by(species) %>% 
  summarize(avg = mean(weight, na.rm=T)) %>% 
  arrange(desc(avg))
  
```

```{r}
deserts %>% 
  filter(species == "albigula" | species == "spectabilis") %>% 
  mutate(ratio = weight/hindfoot_length) %>% 
  ggplot(aes(x = species, y = ratio, fill=sex))+
  geom_boxplot()
```